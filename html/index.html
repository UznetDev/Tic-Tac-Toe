<!DOCTYPE html>
<html>
<head>
    <title>Tic Tac Toe</title>
    <style>
        #board div {
            display: flex;
        }
        #board button {
            width: 60px;
            height: 60px;
            font-size: 24px;
            margin: 2px;
        }
    </style>
    <script>
        let board = [
            [0, 0, 0],
            [0, 0, 0],
            [0, 0, 0]
        ];
        let player = 1;
        let game_id = null;
        let move_number = 1;

        async function startGame() {
            const firstPlayer = document.querySelector('input[name="first_player"]:checked').value;
            const response = await fetch('http://tic-tac-toe-game.codernet.uz/start_game', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    player_piece: player,
                    first_player: firstPlayer
                })
            });
            const data = await response.json();
            game_id = data.game_id;
            board = data.board;
            document.getElementById('message').innerText = data.message;
            renderBoard();
        }

        async function makeMove(x, y) {
            if (board[x][y] !== 0) {
                alert('Invalid move!');
                return;
            }
            const response = await fetch('http://tic-tac-toe-game.codernet.uz/play', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    game_id: game_id,
                    board: board,
                    player: player,
                    position: [x, y],
                    move_number: move_number
                })
            });
            const data = await response.json();
            board = data.board;
            document.getElementById('message').innerText = data.message;
            move_number = data.move_number || move_number + 2;
            renderBoard();
        }

        function renderBoard() {
            let html = '';
            for (let i = 0; i < 3; i++) {
                html += '<div>';
                for (let j = 0; j < 3; j++) {
                    let cell = board[i][j];
                    let symbol = cell === 1 ? 'X' : cell === 2 ? 'O' : '';
                    html += `<button onclick="makeMove(${i}, ${j})">${symbol}</button>`;
                }
                html += '</div>';
            }
            document.getElementById('board').innerHTML = html;
        }

        window.onload = function() {
            document.getElementById('startBtn').addEventListener('click', startGame);
        };
    </script>
</head>
<body>
    <h1>Tic Tac Toe</h1>
    <div>
        <label>Select your piece:</label>
        <select id="player_piece">
            <option value="1">X</option>
            <option value="2">O</option>
        </select>
    </div>
    <div>
        <label>Who starts first?</label>
        <label><input type="radio" name="first_player" value="user" checked> User</label>
        <label><input type="radio" name="first_player" value="computer"> Computer</label>
    </div>
    <button id="startBtn">Start Game</button>
    <div id="board"></div>
    <p id="message"></p>
</body>
</html>
